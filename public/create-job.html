<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post a Job - Job Portal</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">JobPortal</a>
            <nav>
                <a href="/employer-dashboard.html">Dashboard</a>
                <a href="/profile.html">Company Profile</a>
                <a href="/create-job.html">Post a Job</a>
                <a href="#" onclick="logout()" style="color: var(--danger);">Logout</a>
            </nav>
        </div>
    </nav>

    <div class="container" style="padding: 48px 24px; max-width: 800px;">
        <h1 id="pageTitle">Post a New Job</h1>

        <form id="jobForm">
            <input type="hidden" id="jobId">

            <div class="input-group">
                <label>Job Title *</label>
                <input type="text" id="title" placeholder="e.g. Senior Software Engineer" required>
            </div>

            <div class="input-group">
                <label>Job Description *</label>
                <textarea id="description" placeholder="Describe the role, what the candidate will do..." required
                    style="min-height: 150px;"></textarea>
            </div>

            <div class="input-group">
                <label>Qualifications *</label>
                <textarea id="qualifications" placeholder="Required skills, education, certifications..."
                    required></textarea>
            </div>

            <div class="input-group">
                <label>Responsibilities *</label>
                <textarea id="responsibilities" placeholder="Day-to-day responsibilities..." required></textarea>
            </div>

            <div class="grid grid-2">
                <div class="input-group">
                    <label>Job Type *</label>
                    <select id="jobType" required>
                        <option value="">Select type</option>
                        <option value="full-time">Full Time</option>
                        <option value="part-time">Part Time</option>
                        <option value="contract">Contract</option>
                        <option value="internship">Internship</option>
                        <option value="temporary">Temporary</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Status *</label>
                    <select id="status" required>
                        <option value="active">Active</option>
                        <option value="draft">Draft</option>
                        <option value="closed">Closed</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-2">
                <div class="input-group">
                    <label>City *</label>
                    <input type="text" id="city" placeholder="e.g. New York" required>
                </div>
                <div class="input-group">
                    <label>Country *</label>
                    <input type="text" id="country" placeholder="e.g. USA" required>
                </div>
            </div>

            <div class="input-group">
                <label>
                    <input type="checkbox" id="remote" style="width: auto; margin-right: 8px;">
                    Remote Position
                </label>
            </div>

            <div class="grid grid-2">
                <div class="input-group">
                    <label>Minimum Salary (USD) *</label>
                    <input type="number" id="minSalary" placeholder="50000" required>
                </div>
                <div class="input-group">
                    <label>Maximum Salary (USD) *</label>
                    <input type="number" id="maxSalary" placeholder="80000" required>
                </div>
            </div>

            <div style="display: flex; gap: 16px;">
                <button type="submit" class="btn btn-primary" id="saveBtn">Publish Job</button>
                <button type="button" class="btn btn-outline"
                    onclick="window.location.href='/employer-dashboard.html'">Cancel</button>
                <button type="button" class="btn btn-danger" id="deleteBtn" style="display: none; margin-left: auto;"
                    onclick="deleteJob()">Delete Job</button>
            </div>
        </form>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/utils.js"></script>
    <script>
        const user = checkAuth();
        if (!user || user.role !== 'employer') {
            window.location.href = '/login.html';
        }

        const urlParams = new URLSearchParams(window.location.search);
        const jobId = urlParams.get('id');

        if (jobId) {
            document.getElementById('pageTitle').textContent = 'Edit Job';
            document.getElementById('jobId').value = jobId;
            document.getElementById('deleteBtn').style.display = 'block';
            loadJob(jobId);
        }

        async function loadJob(id) {
            try {
                const response = await jobAPI.getJob(id);
                const job = response.job;

                document.getElementById('title').value = job.title;
                document.getElementById('description').value = job.description;
                document.getElementById('qualifications').value = job.qualifications;
                document.getElementById('responsibilities').value = job.responsibilities;
                document.getElementById('jobType').value = job.jobType;
                document.getElementById('status').value = job.status;
                document.getElementById('city').value = job.location.city;
                document.getElementById('country').value = job.location.country;
                document.getElementById('remote').checked = job.location.remote;
                document.getElementById('minSalary').value = job.salaryRange.min;
                document.getElementById('maxSalary').value = job.salaryRange.max;
            } catch (error) {
                showNotification('Failed to load job', 'error');
            }
        }

        document.getElementById('jobForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const saveBtn = document.getElementById('saveBtn');
            const originalText = saveBtn.innerHTML;
            showLoading(saveBtn);

            try {
                const jobData = {
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    qualifications: document.getElementById('qualifications').value,
                    responsibilities: document.getElementById('responsibilities').value,
                    jobType: document.getElementById('jobType').value,
                    status: document.getElementById('status').value,
                    location: {
                        city: document.getElementById('city').value,
                        country: document.getElementById('country').value,
                        remote: document.getElementById('remote').checked
                    },
                    salaryRange: {
                        min: parseInt(document.getElementById('minSalary').value),
                        max: parseInt(document.getElementById('maxSalary').value)
                    }
                };

                if (jobId) {
                    await jobAPI.updateJob(jobId, jobData);
                    showNotification('Job updated successfully!', 'success');
                } else {
                    await jobAPI.createJob(jobData);
                    showNotification('Job posted successfully!', 'success');
                }

                setTimeout(() => {
                    window.location.href = '/employer-dashboard.html';
                }, 1500);
            } catch (error) {
                hideLoading(saveBtn, originalText);
                showNotification(error.message || 'Failed to save job', 'error');
            }
        });

        async function deleteJob() {
            if (!confirm('Are you sure you want to delete this job? This action cannot be undone.')) {
                return;
            }

            try {
                await jobAPI.deleteJob(jobId);
                showNotification('Job deleted successfully!', 'success');
                setTimeout(() => {
                    window.location.href = '/employer-dashboard.html';
                }, 1500);
            } catch (error) {
                showNotification(error.message || 'Failed to delete job', 'error');
            }
        }
    </script>
</body>

</html>